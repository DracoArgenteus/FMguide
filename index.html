<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Folkemødet 2025 - Interactive Event Schedule</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.0.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css">
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <style>
        /* Custom styles for better readability and DataTables integration with Tailwind */
        body {
            font-family: 'Inter', sans-serif;
        }
        .dataTables_wrapper .dataTables_length,
        .dataTables_wrapper .dataTables_filter { /* Grouped filter and length for spacing */
            margin-bottom: 1rem;
        }
        .dataTables_wrapper .dataTables_info,
        .dataTables_wrapper .dataTables_paginate {
            margin-top: 1rem; /* Add space above info and pagination */
        }
        .dataTables_wrapper .dataTables_filter input {
            border: 1px solid #cbd5e1; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 0.75rem; /* py-2 px-3 */
            margin-left: 0.5rem;
        }
        .dataTables_wrapper .dataTables_length select {
            border: 1px solid #cbd5e1; /* gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.5rem 2.5rem 0.5rem 0.75rem; /* py-2 pr-10 pl-3 */
            margin-left: 0.5rem;
            margin-right: 0.5rem;
        }
        /* Style for table headers */
        table.dataTable th {
            background-color: #f3f4f6; /* bg-gray-100 */
            color: #1f2937; /* text-gray-800 */
        }
        /* Ensure table fits well on smaller screens */
        .table-container {
            overflow-x: auto; /* Allows horizontal scrolling for the table on small screens */
        }
        #eventTable {
            width: 100% !important; /* Ensure DataTables takes full width */
        }
        .error-message {
            color: #dc2626; /* Tailwind red-600 */
            background-color: #fee2e2; /* Tailwind red-100 */
            border: 1px solid #fca5a5; /* Tailwind red-300 */
            padding: 1rem;
            border-radius: 0.375rem; /* rounded-md */
            margin-top: 1rem;
        }
        /* Styles for filter buttons */
        .filter-buttons button {
            padding: 0.5rem 1rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem; /* For wrapping on small screens */
            border-radius: 0.375rem; /* rounded-md */
            border: 1px solid transparent;
            transition: background-color 0.2s ease-in-out, border-color 0.2s ease-in-out;
        }
        .filter-buttons button.active-filter {
            background-color: #2563eb; /* Tailwind blue-600 */
            color: white;
            border-color: #1d4ed8; /* Tailwind blue-700 */
        }
        .filter-buttons button:not(.active-filter) {
            background-color: #e5e7eb; /* Tailwind gray-200 */
            color: #374151; /* Tailwind gray-700 */
        }
        .filter-buttons button:not(.active-filter):hover {
            background-color: #d1d5db; /* Tailwind gray-300 */
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 p-4 md:p-8">

    <div class="container mx-auto max-w-7xl">
        <header class="mb-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600">Folkemødet 2025 - Interactive Event Schedule</h1>
            <p class="text-gray-600 mt-2">Browse, search, and sort events. Filter by weekday using the buttons below.</p>
        </header>

        <div id="instructions" class="mb-8 p-6 bg-blue-50 border border-blue-200 rounded-lg shadow">
            <h2 class="text-xl font-semibold text-blue-700 mb-3">How to Use This Page with Your Data</h2>
            <ol class="list-decimal list-inside space-y-2 text-gray-700">
                <li>Save the CSV data (provided in the other artifact, now with fuller descriptions) into a file named `folkemoedet_events.csv`.</li>
                <li>Place this HTML file and the `folkemoedet_events.csv` file in the same folder.</li>
                <li>Follow GitHub Pages instructions if hosting online.</li>
            </ol>
             <p class="mt-4 text-sm text-blue-600"><strong>Note on Pivot Tables:</strong> This setup provides robust sorting, searching, and pagination. True pivot table functionality directly from a static CSV on the client-side is more advanced.</p>
        </div>
        
        <div id="tableErrorMessage" class="hidden error-message"></div>

        <!-- Weekday Filter Buttons -->
        <div class="filter-buttons mb-6 text-center sm:text-left">
            <button data-day="All" class="active-filter">All Days</button>
            <button data-day="Torsdag">Torsdag</button>
            <button data-day="Fredag">Fredag</button>
            <button data-day="Lørdag">Lørdag</button>
            <!-- Add more buttons if other weekdays exist in your data -->
        </div>

        <div class="bg-white p-4 sm:p-6 rounded-lg shadow-lg table-container">
            <table id="eventTable" class="display cell-border hover order-column stripe" style="width:100%">
                <thead>
                    <!-- Table headers will be dynamically generated from CSV -->
                </thead>
                <tbody>
                    <!-- Table body will be dynamically populated from CSV -->
                </tbody>
            </table>
        </div>

        <footer class="mt-12 text-center text-sm text-gray-500">
            <p>&copy; <span id="currentYear"></span> Folkemødet Event Viewer. Data processed from supplied documents.</p>
        </footer>
    </div>

    <script>
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();

        $(document).ready(function() {
            const csvFilePath = 'folkemoedet_events.csv';
            const tableErrorMessageDiv = document.getElementById('tableErrorMessage');
            let eventDataTable = null; // To store the DataTable instance

            function robustParseCSV(csvText) {
                const lines = csvText.trim().replace(/\r\n/g, '\n').replace(/\r/g, '\n').split('\n');
                if (lines.length === 0 || (lines.length === 1 && lines[0].trim() === "")) {
                    return { headers: [], data: [] };
                }
                const splitCsvLine = (line) => {
                    const result = [];
                    let current = '';
                    let inQuotes = false;
                    for (let i = 0; i < line.length; i++) {
                        const char = line[i];
                        if (char === '"') {
                            if (i + 1 < line.length && line[i+1] === '"') {
                                current += '"'; i++;
                            } else {
                                inQuotes = !inQuotes;
                            }
                        } else if (char === ',' && !inQuotes) {
                            result.push(current.trim()); current = '';
                        } else {
                            current += char;
                        }
                    }
                    result.push(current.trim()); 
                    return result.map(field => field.replace(/^"|"$/g, '').replace(/""/g, '"'));
                };
                const headers = splitCsvLine(lines[0]);
                const data = [];
                for (let i = 1; i < lines.length; i++) {
                    if (lines[i].trim() === "") continue; 
                    const values = splitCsvLine(lines[i]);
                    if (values.length === headers.length) {
                        let row = {};
                        headers.forEach((header, index) => { row[header] = values[index]; });
                        data.push(row);
                    } else {
                        console.warn("Skipping malformed CSV line (field count mismatch):", `Line ${i+1}: "${lines[i]}"`, "Expected", headers.length, "fields, got", values.length);
                    }
                }
                return { headers, data };
            }

            fetch(csvFilePath)
                .then(response => {
                    if (!response.ok) {
                        let errorDetail = `HTTP error! Status: ${response.status}.`;
                        if (response.status === 404) {
                            errorDetail += ` The file '${csvFilePath}' was not found. Ensure it's in the same directory and name is correct.`;
                        }
                        throw new Error(errorDetail);
                    }
                    return response.text();
                })
                .then(csvText => {
                    tableErrorMessageDiv.classList.add('hidden');
                    const { headers, data } = robustParseCSV(csvText);

                    if (headers.length === 0 ) {
                         const message = `Could not parse CSV headers from '${csvFilePath}'. Check CSV format.`;
                        console.error(message);
                        tableErrorMessageDiv.textContent = message;
                        tableErrorMessageDiv.classList.remove('hidden');
                        $('#eventTable').html('<thead><tr><th>Error</th></tr></thead><tbody><tr><td>Could not display data.</td></tr></tbody>');
                        return;
                    }
                    
                    let headerHtml = '<tr>';
                    headers.forEach(header => {
                        headerHtml += `<th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">${header}</th>`;
                    });
                    headerHtml += '</tr>';
                    $('#eventTable thead').html(headerHtml);

                    const dataSet = data.map(row => headers.map(header => row[header]));

                    eventDataTable = $('#eventTable').DataTable({ // Assign to eventDataTable
                        data: dataSet,
                        responsive: true,
                        lengthMenu: [[10, 25, 50, -1], [10, 25, 50, "All"]],
                        pageLength: 10,
                        language: {
                            search: "_INPUT_",
                            searchPlaceholder: "Search events...",
                            lengthMenu: "Show _MENU_ entries",
                            zeroRecords: "No matching events found",
                            emptyTable: "No events available in table"
                        },
                        order: [[0, 'asc']], 
                        columnDefs: [ 
                            { width: '10%', targets: 0 }, // Weekday
                            { width: '15%', targets: 1 }  // Time
                        ]
                    });
                })
                .catch(error => {
                    console.error('Error initializing table:', error);
                    const fullErrorMessage = `Failed to load or process '${csvFilePath}'. Error: ${error.message}. Check console (F12) and file location/name.`;
                    tableErrorMessageDiv.textContent = fullErrorMessage;
                    tableErrorMessageDiv.classList.remove('hidden');
                    $('#eventTable').html(`<thead><tr><th>Loading Error</th></tr></thead><tbody><tr><td>Could not load data.</td></tr></tbody>`);
                });

            // Event listeners for filter buttons
            $('.filter-buttons button').on('click', function() {
                const dayFilter = $(this).data('day');
                
                // Update active button style
                $('.filter-buttons button').removeClass('active-filter');
                $(this).addClass('active-filter');

                if (eventDataTable) {
                    if (dayFilter === "All") {
                        eventDataTable.column(0).search('').draw(); // Clear search on the first column (Weekday)
                    } else {
                        // Search for the exact day string, case-sensitive.
                        // Use '^' + dayFilter + '$' for exact match regex.
                        eventDataTable.column(0).search('^' + dayFilter + '$', true, false).draw();
                    }
                }
            });
        });
    </script>

</body>
</html>
